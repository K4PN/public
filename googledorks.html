<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Mapache Google Dorks</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --bg:#0e1116; --panel:#151a21; --ink:#e8eef6; --muted:#a7b3c2; --acc:#4cc9f0; --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444;
    --br:16px; --gap:12px; --pad:14px; --shadow:0 8px 24px rgba(0,0,0,.25);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink);-webkit-tap-highlight-color:transparent}
  header{padding:18px 16px 6px; text-align:center}
  h1{margin:0;font-size:1.2rem;letter-spacing:.3px}
  .wrap{max-width:720px;margin:0 auto;padding:10px;display:flex;flex-direction:column;gap:var(--gap)}
  .card{background:var(--panel);border-radius:var(--br);padding:var(--pad);box-shadow:var(--shadow)}
  label{display:block;font-size:.9rem;color:var(--muted);margin-bottom:6px}
  select, input[type="text"]{
    width:100%;padding:12px 14px;border-radius:12px;background:#0d131b;color:var(--ink);
    border:1px solid #253042;font-size:1rem;outline:none
  }
  .row{display:flex;gap:10px;align-items:center}
  .row > *{flex:1}
  .btn{
    appearance:none;border:0;border-radius:12px;padding:12px 14px;font-weight:600;
    background:#223146;color:#e8f3ff;cursor:pointer
  }
  .btn:hover{filter:brightness(1.08)}
  .btn:active{transform:translateY(1px)}
  .btn-acc{background:linear-gradient(180deg,#58d3fa,#2ea8d1)}
  .btn-ok{background:linear-gradient(180deg,#3bd67a,#19a754)}
  .btn-danger{background:#3a1c1c}
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{
    display:inline-flex;align-items:center;gap:8px;background:#0f1622;border:1px solid #263347;color:#cfe7ff;
    padding:8px 10px;border-radius:999px;font-size:.92rem
  }
  .chip small{color:#8fb9d8}
  .chip button{
    all:unset;cursor:pointer;background:#223146;border-radius:999px;padding:4px 6px;font-size:.8rem
  }
  .ops{display:flex;gap:8px;flex-wrap:wrap}
  .ops button{flex:1;outline:2px solid transparent}
  .ops button.active{outline:2px solid var(--acc)}
  .preview{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;background:#0b1119;border:1px solid #263247;border-radius:12px;padding:12px;min-height:56px;word-break:break-word}
  .muted{color:var(--muted);font-size:.9rem}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap}
  .foot{opacity:.8;text-align:center;font-size:.8rem}
  .help{font-size:.9rem;color:var(--muted);line-height:1.35}
  .seg{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:end}
  @media (min-width:560px){ .seg{grid-template-columns:1fr 180px} }
</style>
</head>
<body>
<header>
  <h1>ü¶ù Mapache Google Dorks</h1>
  <div class="muted">Construye tu consulta eligiendo dorks, texto y uniones (AND / OR / espacio).</div>
</header>

<main class="wrap">
  <section class="card" aria-labelledby="lblDork">
    <label id="lblDork">1) Elige un dork</label>
    <div class="row">
      <select id="dork">
        <option value="none">Ninguno (texto libre)</option>
        <option value="quotes">"Frase exacta"</option>
        <option value="minus">-Exclusi√≥n</option>
        <option value="plus">+Obligatorio</option>
        <option value="inurl">inurl:</option>
        <option value="intitle">intitle:</option>
        <option value="site">site:</option>
        <option value="intext">intext:</option>
        <option value="filetype">filetype:</option>
        <option value="cache">cache:</option>
        <option value="related">related:</option>
        <option value="allintitle">allintitle:</option>
        <option value="allinurl">allinurl:</option>
        <option value="allintext">allintext:</option>
      </select>
    </div>

    <div class="seg" style="margin-top:10px">
      <div>
        <label for="valor">2) Escribe el texto</label>
        <input id="valor" type="text" inputmode="text" placeholder='Ej.: informe 2024.pdf / ejemplo.com / "frase exacta"' />
      </div>
      <div>
        <label>3) Uni√≥n con lo anterior</label>
        <div class="ops" role="group" aria-label="Uniones">
          <button type="button" class="btn active" data-op="space" title="Espacio (equivale a AND)">Espacio</button>
          <button type="button" class="btn" data-op="AND">AND</button>
          <button type="button" class="btn" data-op="OR">OR</button>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <button type="button" class="btn btn-acc" id="add">‚ûï A√±adir</button>
      <button type="button" class="btn btn-danger" id="clear">üóëÔ∏è Limpiar</button>
    </div>

    <div class="help" style="margin-top:8px">
      Consejos: usa comillas para frases exactas. Puedes combinarlas con <code>-</code> o <code>+</code> (p. ej. <code>-"contrato privado"</code>).  
      <strong>Espacio</strong> se comporta como AND. Usa <strong>OR</strong> cuando cualquiera de los t√©rminos te valga.
    </div>
  </section>

  <section class="card">
    <label>Elementos de la consulta</label>
    <div id="chips" class="chips" aria-live="polite"></div>
  </section>

  <section class="card">
    <label>Consulta actual</label>
    <div id="preview" class="preview" aria-live="polite"></div>
    <div class="toolbar" style="margin-top:10px">
      <button type="button" class="btn btn-ok" id="copy">üìã Copiar</button>
      <button type="button" class="btn btn-acc" id="search">üîé Buscar en Google</button>
    </div>
    <div class="help" style="margin-top:8px">
      Nota: Google ha cambiado el comportamiento de <code>+</code> hist√≥ricamente; sigue siendo √∫til para delimitar, pero prioriza comillas para exactitud.
    </div>
  </section>

  <div class="foot">¬© Mapache ‚Ä¢ Construcci√≥n r√°pida de dorks</div>
</main>

<script>
(() => {
  const $ = s => document.querySelector(s);
  const dorkSel = $('#dork');
  const valor = $('#valor');
  const chips = $('#chips');
  const preview = $('#preview');
  const addBtn = $('#add');
  const clearBtn = $('#clear');
  const copyBtn = $('#copy');
  const searchBtn = $('#search');
  const opBtns = Array.from(document.querySelectorAll('.ops .btn'));

  // Estado
  let parts = []; // {raw, shown, op}
  let pendingOp = 'space'; // uni√≥n por defecto

  // LocalStorage seguro
  const safe = {
    load(){
      try{ return JSON.parse(localStorage.getItem('mapache_dorks_v1')||'[]'); }
      catch{ return []; }
    },
    save(data){
      try{ localStorage.setItem('mapache_dorks_v1', JSON.stringify(data)); }
      catch{ /* modo privado / sin almacenamiento */ }
    }
  };

  // Restaurar
  const saved = safe.load();
  if (Array.isArray(saved) && saved.length){ parts = saved; render(); }

  // Selecci√≥n de uni√≥n
  opBtns.forEach(b=>{
    b.addEventListener('click', ()=>{
      pendingOp = b.dataset.op;
      opBtns.forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
    }, {passive:true});
  });

  function needsQuotes(s){
    if(/^".+"$/.test(s)) return false;
    return /[\s]/.test(s);
  }

  function fmtPiece(kind, text){
    const t = text.trim();
    if(!t) return '';

    switch(kind){
      case 'none':
        return t;
      case 'quotes':
        return /^".+"$/.test(t) ? t : `"${t}"`;
      case 'minus':
        if (needsQuotes(t)) return `-"${t.replace(/^"|"$/g,'')}"`;
        return `-${t}`;
      case 'plus':
        if (needsQuotes(t)) return `+"${t.replace(/^"|"$/g,'')}"`;
        return `+${t}`;
      case 'inurl':
      case 'intitle':
      case 'site':
      case 'intext':
      case 'filetype':
      case 'cache':
      case 'related':
      case 'allintitle':
      case 'allinurl':
      case 'allintext':
        if(/^allin/.test(kind)){
          return `${kind}:${t}`;
        }
        if (needsQuotes(t)) return `${kind}:"${t.replace(/^"|"$/g,'')}"`;
        return `${kind}:${t}`;
      default:
        return t;
    }
  }

  function render(){
    // Chips
    chips.innerHTML = '';
    parts.forEach((p, idx)=>{
      const el = document.createElement('div');
      el.className = 'chip';
      el.innerHTML = `<span>${p.shown}</span><small>${p.op.toUpperCase()==='SPACE'?'espacio':p.op}</small>
                      <button type="button" aria-label="Eliminar">‚úï</button>`;
      el.querySelector('button').addEventListener('click', ()=>{
        parts.splice(idx,1);
        safe.save(parts);
        render();
      }, {passive:true});
      chips.appendChild(el);
    });

    // Preview
    let out = '';
    parts.forEach((p,i)=>{
      if(i===0){ out += p.shown; return; }
      if(p.op==='space'){ out += ' ' + p.shown; }
      else { out += ' ' + p.op + ' ' + p.shown; }
    });
    preview.textContent = out.trim();
  }

  addBtn.addEventListener('click', ()=>{
    const kind = dorkSel.value;
    const text = valor.value;
    const piece = fmtPiece(kind, text);
    if(!piece){
      valor.focus();
      return;
    }
    const op = (parts.length===0) ? 'space' : pendingOp;
    parts.push({raw: piece, shown: piece, op});
    safe.save(parts);
    render();
    valor.value='';
    valor.focus();
  }, {passive:true});

  clearBtn.addEventListener('click', ()=>{
    parts = [];
    safe.save(parts);
    render();
    valor.value='';
    // Visual: vuelve a marcar "Espacio"
    pendingOp = 'space';
    opBtns.forEach(x=>x.classList.remove('active'));
    opBtns.find(b=>b.dataset.op==='space').classList.add('active');
    valor.focus();
  }, {passive:true});

  copyBtn.addEventListener('click', async ()=>{
    const q = preview.textContent.trim();
    if(!q) return;
    try{
      await navigator.clipboard.writeText(q);
      flash(copyBtn,'‚úÖ Copiado','üìã Copiar');
    }catch{
      // Fallback
      const ta = document.createElement('textarea');
      ta.value = q; document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); }catch{}
      document.body.removeChild(ta);
      flash(copyBtn,'‚úÖ Copiado','üìã Copiar');
    }
  }, {passive:true});

  searchBtn.addEventListener('click', ()=>{
    const q = preview.textContent.trim();
    if(!q) return;
    const url = 'https://www.google.com/search?q=' + encodeURIComponent(q);
    window.open(url, '_blank', 'noopener');
  }, {passive:true});

  // UX: Enter para a√±adir
  valor.addEventListener('keydown', (e)=>{
    if(e.key==='Enter'){
      e.preventDefault();
      addBtn.click();
    }
  });

  function flash(btn, now, later){
    const old = btn.textContent;
    btn.textContent = now || 'Listo';
    setTimeout(()=>btn.textContent = later || old, 1200);
  }

  // Asegura que ‚ÄúEspacio‚Äù aparezca seleccionado al cargar
  opBtns.forEach(x=>x.classList.remove('active'));
  opBtns.find(b=>b.dataset.op==='space').classList.add('active');
})();
</script>
</body>
</html>
