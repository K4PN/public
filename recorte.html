<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor Instagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 10px;
            color: #333;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px 20px;
        }
        
        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
        }
        
        .upload-area:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .upload-area.dragover {
            border-color: #667eea;
            background: #e8f0ff;
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: #667eea;
        }
        
        .upload-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .upload-subtext {
            font-size: 12px;
            color: #999;
        }
        
        #fileInput {
            display: none;
        }
        
        .format-selection {
            margin-top: 30px;
        }
        
        .format-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }
        
        .format-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .format-option {
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .format-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }
        
        .format-option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .format-name {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .format-ratio {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .format-preview {
            width: 60px;
            height: 60px;
            border: 1px solid #ddd;
            margin: 0 auto;
            background: #f8f9fa;
        }
        
        .square { aspect-ratio: 1/1; }
        .portrait { aspect-ratio: 4/5; height: 75px; }
        .landscape { aspect-ratio: 1.91/1; height: 31px; }
        .story { aspect-ratio: 9/16; height: 106px; width: 60px; }
        
        .crop-container {
            position: relative;
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            background: #f8f9fa;
        }
        
        .preview-image {
            max-width: 100%;
            height: auto;
            display: block;
        }
        
        .crop-overlay {
            position: absolute;
            border: 3px solid #667eea;
            cursor: move;
            box-shadow: 0 0 0 1000px rgba(0,0,0,0.5);
        }
        
        .crop-handle {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #667eea;
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .crop-handle.nw { top: -10px; left: -10px; cursor: nw-resize; }
        .crop-handle.ne { top: -10px; right: -10px; cursor: ne-resize; }
        .crop-handle.sw { bottom: -10px; left: -10px; cursor: sw-resize; }
        .crop-handle.se { bottom: -10px; right: -10px; cursor: se-resize; }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e1e5e9;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .hidden {
            display: none;
        }
        
        .result-container {
            text-align: center;
            margin-top: 20px;
        }
        
        .result-image {
            max-width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .download-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #666;
        }
        
        @media (max-width: 480px) {
            .container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }
            
            .content {
                padding: 20px 15px;
            }
            
            .format-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .controls {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì∏ Conversor Instagram</h1>
            <p>Adapta tus fotos a los formatos perfectos</p>
        </div>
        
        <div class="content">
            <!-- Paso 1: Subir imagen -->
            <div id="uploadStep">
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">Toca para seleccionar imagen</div>
                    <div class="upload-subtext">O arrastra y suelta aqu√≠</div>
                </div>
                <input type="file" id="fileInput" accept="image/*">
            </div>
            
            <!-- Paso 2: Seleccionar formato -->
            <div id="formatStep" class="hidden">
                <div class="format-selection">
                    <div class="format-title">Elige el formato de Instagram:</div>
                    <div class="format-grid">
                        <div class="format-option" data-format="square">
                            <div class="format-name">Post Cuadrado</div>
                            <div class="format-ratio">1:1 ‚Ä¢ 1080x1080</div>
                            <div class="format-preview square"></div>
                        </div>
                        <div class="format-option" data-format="portrait">
                            <div class="format-name">Post Vertical</div>
                            <div class="format-ratio">4:5 ‚Ä¢ 1080x1350</div>
                            <div class="format-preview portrait"></div>
                        </div>
                        <div class="format-option" data-format="landscape">
                            <div class="format-name">Post Horizontal</div>
                            <div class="format-ratio">1.91:1 ‚Ä¢ 1080x566</div>
                            <div class="format-preview landscape"></div>
                        </div>
                        <div class="format-option" data-format="story">
                            <div class="format-name">Story/Reels</div>
                            <div class="format-ratio">9:16 ‚Ä¢ 1080x1920</div>
                            <div class="format-preview story"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Paso 3: Recortar imagen -->
            <div id="cropStep" class="hidden">
                <div class="format-title">Ajusta el recorte:</div>
                <div class="crop-container">
                    <img id="previewImage" class="preview-image">
                    <div id="cropOverlay" class="crop-overlay">
                        <div class="crop-handle nw"></div>
                        <div class="crop-handle ne"></div>
                        <div class="crop-handle sw"></div>
                        <div class="crop-handle se"></div>
                    </div>
                </div>
                <div class="controls">
                    <button class="btn btn-secondary" onclick="goBack()">Volver</button>
                    <button class="btn btn-primary" onclick="processImage()">Procesar</button>
                </div>
            </div>
            
            <!-- Paso 4: Resultado -->
            <div id="resultStep" class="hidden">
                <div class="format-title">¬°Listo para Instagram!</div>
                <div class="result-container">
                    <img id="resultImage" class="result-image">
                    <div class="download-info">
                        <strong>Formato:</strong> <span id="formatInfo"></span><br>
                        <strong>Resoluci√≥n:</strong> <span id="resolutionInfo"></span>
                    </div>
                    <div class="controls">
                        <button class="btn btn-secondary" onclick="startOver()">Nueva Imagen</button>
                        <button class="btn btn-primary" onclick="downloadImage()">Descargar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentImage = null;
        let selectedFormat = null;
        let cropData = { x: 0, y: 0, width: 0, height: 0 };
        let isDragging = false;
        let isResizing = false;
        let startX, startY, startWidth, startHeight, startLeft, startTop;
        let resizeHandle = null;
        
        const formats = {
            square: { ratio: 1, width: 1080, height: 1080, name: 'Post Cuadrado' },
            portrait: { ratio: 4/5, width: 1080, height: 1350, name: 'Post Vertical' },
            landscape: { ratio: 1.91, width: 1080, height: 566, name: 'Post Horizontal' },
            story: { ratio: 9/16, width: 1080, height: 1920, name: 'Story/Reels' }
        };
        
        // Configurar eventos
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);
        
        // Drag and drop
        const uploadArea = document.querySelector('.upload-area');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        // Selecci√≥n de formato
        document.querySelectorAll('.format-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.format-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedFormat = option.dataset.format;
                setTimeout(() => showCropStep(), 300);
            });
        });
        
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }
        
        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('Por favor selecciona una imagen v√°lida');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                currentImage = new Image();
                currentImage.onload = () => {
                    showFormatStep();
                };
                currentImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function showFormatStep() {
            document.getElementById('uploadStep').classList.add('hidden');
            document.getElementById('formatStep').classList.remove('hidden');
        }
        
        function showCropStep() {
            document.getElementById('formatStep').classList.add('hidden');
            document.getElementById('cropStep').classList.remove('hidden');
            
            const previewImage = document.getElementById('previewImage');
            previewImage.src = currentImage.src;
            
            previewImage.onload = () => {
                setupCropOverlay();
            };
        }
        
        function setupCropOverlay() {
            const previewImage = document.getElementById('previewImage');
            const overlay = document.getElementById('cropOverlay');
            const container = previewImage.parentElement;
            
            const imageRect = previewImage.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const format = formats[selectedFormat];
            const imageAspect = previewImage.naturalWidth / previewImage.naturalHeight;
            const targetAspect = format.ratio;
            
            let cropWidth, cropHeight;
            
            if (imageAspect > targetAspect) {
                cropHeight = imageRect.height * 0.8;
                cropWidth = cropHeight * targetAspect;
            } else {
                cropWidth = imageRect.width * 0.8;
                cropHeight = cropWidth / targetAspect;
            }
            
            const x = (imageRect.width - cropWidth) / 2;
            const y = (imageRect.height - cropHeight) / 2;
            
            overlay.style.left = x + 'px';
            overlay.style.top = y + 'px';
            overlay.style.width = cropWidth + 'px';
            overlay.style.height = cropHeight + 'px';
            
            cropData = { x, y, width: cropWidth, height: cropHeight };
            
            setupCropEvents();
        }
        
        function setupCropEvents() {
            const overlay = document.getElementById('cropOverlay');
            const handles = overlay.querySelectorAll('.crop-handle');
            
            // Mover overlay
            overlay.addEventListener('mousedown', startDrag);
            overlay.addEventListener('touchstart', startDrag);
            
            // Redimensionar con handles
            handles.forEach(handle => {
                handle.addEventListener('mousedown', (e) => startResize(e, handle.classList[1]));
                handle.addEventListener('touchstart', (e) => startResize(e, handle.classList[1]));
            });
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('touchmove', handleMouseMove);
            document.addEventListener('mouseup', stopDragResize);
            document.addEventListener('touchend', stopDragResize);
        }
        
        function startDrag(e) {
            if (e.target.classList.contains('crop-handle')) return;
            e.preventDefault();
            isDragging = true;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            startX = clientX - cropData.x;
            startY = clientY - cropData.y;
        }
        
        function startResize(e, handle) {
            e.preventDefault();
            e.stopPropagation();
            isResizing = true;
            resizeHandle = handle;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            startX = clientX;
            startY = clientY;
            startWidth = cropData.width;
            startHeight = cropData.height;
            startLeft = cropData.x;
            startTop = cropData.y;
        }
        
        function handleMouseMove(e) {
            e.preventDefault();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            if (isDragging) {
                const previewImage = document.getElementById('previewImage');
                const imageRect = previewImage.getBoundingClientRect();
                
                let newX = clientX - startX;
                let newY = clientY - startY;
                
                newX = Math.max(0, Math.min(newX, imageRect.width - cropData.width));
                newY = Math.max(0, Math.min(newY, imageRect.height - cropData.height));
                
                updateCropOverlay(newX, newY, cropData.width, cropData.height);
            }
            
            if (isResizing) {
                const format = formats[selectedFormat];
                const deltaX = clientX - startX;
                const deltaY = clientY - startY;
                
                let newWidth = startWidth;
                let newHeight = startHeight;
                let newLeft = startLeft;
                let newTop = startTop;
                
                if (resizeHandle.includes('e')) {
                    newWidth = startWidth + deltaX;
                }
                if (resizeHandle.includes('w')) {
                    newWidth = startWidth - deltaX;
                    newLeft = startLeft + deltaX;
                }
                if (resizeHandle.includes('s')) {
                    newHeight = startHeight + deltaY;
                }
                if (resizeHandle.includes('n')) {
                    newHeight = startHeight - deltaY;
                    newTop = startTop + deltaY;
                }
                
                // Mantener proporci√≥n
                if (format.ratio > 1) {
                    newHeight = newWidth / format.ratio;
                } else {
                    newWidth = newHeight * format.ratio;
                }
                
                // Limitar al √°rea de la imagen
                const previewImage = document.getElementById('previewImage');
                const imageRect = previewImage.getBoundingClientRect();
                
                newWidth = Math.max(50, Math.min(newWidth, imageRect.width));
                newHeight = Math.max(50, Math.min(newHeight, imageRect.height));
                newLeft = Math.max(0, Math.min(newLeft, imageRect.width - newWidth));
                newTop = Math.max(0, Math.min(newTop, imageRect.height - newHeight));
                
                updateCropOverlay(newLeft, newTop, newWidth, newHeight);
            }
        }
        
        function stopDragResize() {
            isDragging = false;
            isResizing = false;
            resizeHandle = null;
        }
        
        function updateCropOverlay(x, y, width, height) {
            const overlay = document.getElementById('cropOverlay');
            overlay.style.left = x + 'px';
            overlay.style.top = y + 'px';
            overlay.style.width = width + 'px';
            overlay.style.height = height + 'px';
            
            cropData = { x, y, width, height };
        }
        
        function processImage() {
            const previewImage = document.getElementById('previewImage');
            const format = formats[selectedFormat];
            
            const canvas = document.createElement('canvas');
            canvas.width = format.width;
            canvas.height = format.height;
            const ctx = canvas.getContext('2d');
            
            // Calcular coordenadas de recorte en la imagen original
            const scaleX = currentImage.naturalWidth / previewImage.clientWidth;
            const scaleY = currentImage.naturalHeight / previewImage.clientHeight;
            
            const sourceX = cropData.x * scaleX;
            const sourceY = cropData.y * scaleY;
            const sourceWidth = cropData.width * scaleX;
            const sourceHeight = cropData.height * scaleY;
            
            ctx.drawImage(
                currentImage,
                sourceX, sourceY, sourceWidth, sourceHeight,
                0, 0, format.width, format.height
            );
            
            const resultDataUrl = canvas.toDataURL('image/jpeg', 0.9);
            
            document.getElementById('resultImage').src = resultDataUrl;
            document.getElementById('formatInfo').textContent = format.name;
            document.getElementById('resolutionInfo').textContent = `${format.width}x${format.height}px`;
            
            showResultStep();
        }
        
        function showResultStep() {
            document.getElementById('cropStep').classList.add('hidden');
            document.getElementById('resultStep').classList.remove('hidden');
        }
        
        function downloadImage() {
            const resultImage = document.getElementById('resultImage');
            const format = formats[selectedFormat];
            
            const link = document.createElement('a');
            link.download = `instagram-${selectedFormat}-${format.width}x${format.height}.jpg`;
            link.href = resultImage.src;
            link.click();
        }
        
        function goBack() {
            document.getElementById('cropStep').classList.add('hidden');
            document.getElementById('formatStep').classList.remove('hidden');
            document.querySelectorAll('.format-option').forEach(opt => opt.classList.remove('selected'));
            selectedFormat = null;
        }
        
        function startOver() {
            document.getElementById('resultStep').classList.add('hidden');
            document.getElementById('uploadStep').classList.remove('hidden');
            document.getElementById('fileInput').value = '';
            currentImage = null;
            selectedFormat = null;
        }
    </script>
</body>
</html>