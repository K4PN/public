<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Plataforma Shooter Gameboy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
            image-rendering: pixelated;
        }

        body {
            background-color: #0a0a0a;
            font-family: 'Courier New', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            color: #8bac0f;
        }

        #game-container {
            width: 100%;
            max-width: 500px;
            position: relative;
        }

        #game-screen {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 66.67%; /* Relación 2:3 para la pantalla superior */
            background-color: #0f380f;
            border: 8px solid #9bbc0f;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        #game-canvas {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        #controls-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0 10px;
        }

        #d-pad {
            width: 150px;
            height: 150px;
            position: relative;
        }

        .d-pad-btn {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: #9bbc0f;
            border: none;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #0f380f;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 4px #306230;
            transition: all 0.05s;
        }

        .d-pad-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px #306230;
        }

        #up {
            top: 0;
            left: 50px;
        }

        #down {
            bottom: 0;
            left: 50px;
        }

        #left {
            top: 50px;
            left: 0;
        }

        #right {
            top: 50px;
            right: 0;
        }

        #action-buttons {
            display: flex;
            align-items: center;
        }

        #shoot-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #ff4c4c;
            border: none;
            box-shadow: 0 6px #cc0000;
            font-size: 16px;
            font-weight: bold;
            color: white;
            transition: all 0.05s;
        }

        #shoot-btn:active {
            transform: translateY(3px);
            box-shadow: 0 3px #cc0000;
        }

        #score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 16px;
            color: #9bbc0f;
            z-index: 10;
        }

        #health {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 16px;
            color: #9bbc0f;
            z-index: 10;
        }

        #game-over, #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(15, 56, 15, 0.9);
            z-index: 20;
            color: #9bbc0f;
        }

        #start-screen {
            display: flex;
        }

        #game-over {
            display: none;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        button {
            padding: 10px 20px;
            background-color: #9bbc0f;
            border: none;
            border-radius: 8px;
            color: #0f380f;
            font-weight: bold;
            margin-top: 20px;
            box-shadow: 0 4px #306230;
        }

        #instructions {
            margin-top: 20px;
            text-align: center;
            font-size: 14px;
            padding: 0 20px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-screen">
            <canvas id="game-canvas"></canvas>
            <div id="score">Puntos: 0</div>
            <div id="health">Vida: 100</div>
            
            <div id="start-screen">
                <h1>PLATAFORMA SHOOTER</h1>
                <button id="start-btn">JUGAR</button>
                <div id="instructions">
                    Usa la cruceta para moverte y el botón rojo para disparar. Elimina a todos los enemigos.
                </div>
            </div>
            
            <div id="game-over">
                <h1>GAME OVER</h1>
                <div id="final-score">Puntos: 0</div>
                <button id="restart-btn">REJUGAR</button>
            </div>
        </div>
        
        <div id="controls-container">
            <div id="d-pad">
                <button class="d-pad-btn" id="up">↑</button>
                <button class="d-pad-btn" id="down">↓</button>
                <button class="d-pad-btn" id="left">←</button>
                <button class="d-pad-btn" id="right">→</button>
            </div>
            
            <div id="action-buttons">
                <button id="shoot-btn">DISPARAR</button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales del juego
        let canvas, ctx;
        let player;
        let enemies = [];
        let bullets = [];
        let platforms = [];
        let score = 0;
        let gameRunning = false;
        let keys = {};
        let lastTime = 0;
        let enemySpawnTimer = 0;
        let backgroundPattern;

        // Clase del jugador
        class Player {
            constructor() {
                this.width = 30;
                this.height = 40;
                this.x = canvas.width / 2 - this.width / 2;
                this.y = canvas.height - 150;
                this.speed = 5;
                this.velX = 0;
                this.velY = 0;
                this.jumping = false;
                this.grounded = false;
                this.health = 100;
                this.facing = 'right';
                this.shootCooldown = 0;
            }
            
            update(deltaTime) {
                // Movimiento horizontal
                this.velX = 0;
                
                if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
                    this.velX = -this.speed;
                    this.facing = 'left';
                }
                
                if (keys['ArrowRight'] || keys['d'] || keys['D']) {
                    this.velX = this.speed;
                    this.facing = 'right';
                }
                
                this.x += this.velX;
                
                // Gravedad y salto
                this.velY += 0.5; // Gravedad
                if (this.velY > 10) this.velY = 10; // Velocidad terminal
                
                if ((keys['ArrowUp'] || keys['w'] || keys['W'] || keys[' ']) && this.grounded) {
                    this.velY = -12;
                    this.grounded = false;
                }
                
                this.y += this.velY;
                
                // Limites de pantalla
                if (this.x < 0) this.x = 0;
                if (this.x + this.width > canvas.width) this.x = canvas.width - this.width;
                if (this.y < 0) this.y = 0;
                if (this.y + this.height > canvas.height) {
                    this.y = canvas.height - this.height;
                    this.grounded = true;
                    this.velY = 0;
                }
                
                // Colisión con plataformas
                this.grounded = false;
                for (let platform of platforms) {
                    if (this.velY > 0 && 
                        this.x + this.width > platform.x && 
                        this.x < platform.x + platform.width &&
                        this.y + this.height > platform.y &&
                        this.y + this.height < platform.y + platform.height) {
                        this.y = platform.y - this.height;
                        this.velY = 0;
                        this.grounded = true;
                    }
                }
                
                // Enfriamiento de disparo
                if (this.shootCooldown > 0) {
                    this.shootCooldown -= deltaTime;
                }
                
                // Disparar
                if ((keys['x'] || keys['X'] || keys['Enter']) && this.shootCooldown <= 0) {
                    this.shoot();
                    this.shootCooldown = 200; // 200 ms de enfriamiento
                }
            }
            
            shoot() {
                const bulletX = this.facing === 'right' ? this.x + this.width : this.x;
                bullets.push(new Bullet(bulletX, this.y + this.height / 2 - 5, this.facing));
            }
            
            draw() {
                ctx.fillStyle = '#8bac0f';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // Dibujar ojos según la dirección
                ctx.fillStyle = '#0f380f';
                if (this.facing === 'right') {
                    ctx.fillRect(this.x + this.width - 10, this.y + 10, 5, 5);
                } else {
                    ctx.fillRect(this.x + 5, this.y + 10, 5, 5);
                }
            }
            
            takeDamage(amount) {
                this.health -= amount;
                document.getElementById('health').textContent = `Vida: ${this.health}`;
                
                if (this.health <= 0) {
                    gameOver();
                }
            }
        }

        // Clase de enemigos
        class Enemy {
            constructor(x, y) {
                this.width = 30;
                this.height = 30;
                this.x = x;
                this.y = y;
                this.speed = 2;
                this.health = 3;
            }
            
            update() {
                // Seguir al jugador
                if (player.x < this.x) {
                    this.x -= this.speed;
                } else if (player.x > this.x) {
                    this.x += this.speed;
                }
                
                // Colisión con el jugador
                if (this.collideWith(player)) {
                    player.takeDamage(0.5);
                }
            }
            
            draw() {
                ctx.fillStyle = '#ff4c4c';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // Ojos
                ctx.fillStyle = '#0f380f';
                ctx.fillRect(this.x + 5, this.y + 10, 5, 5);
                ctx.fillRect(this.x + 20, this.y + 10, 5, 5);
            }
            
            collideWith(object) {
                return this.x < object.x + object.width &&
                       this.x + this.width > object.x &&
                       this.y < object.y + object.height &&
                       this.y + this.height > object.y;
            }
            
            takeDamage() {
                this.health--;
                return this.health <= 0;
            }
        }

        // Clase de balas
        class Bullet {
            constructor(x, y, direction) {
                this.x = x;
                this.y = y;
                this.width = 10;
                this.height = 5;
                this.speed = 10;
                this.direction = direction;
            }
            
            update() {
                if (this.direction === 'right') {
                    this.x += this.speed;
                } else {
                    this.x -= this.speed;
                }
                
                // Eliminar balas fuera de pantalla
                return this.x > canvas.width || this.x + this.width < 0;
            }
            
            draw() {
                ctx.fillStyle = '#9bbc0f';
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
            
            collideWith(object) {
                return this.x < object.x + object.width &&
                       this.x + this.width > object.x &&
                       this.y < object.y + object.height &&
                       this.y + this.height > object.y;
            }
        }

        // Clase de plataformas
        class Platform {
            constructor(x, y, width, height) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }
            
            draw() {
                ctx.fillStyle = '#306230';
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        // Inicializar el juego
        function init() {
            canvas = document.getElementById('game-canvas');
            ctx = canvas.getContext('2d');
            
            // Ajustar tamaño del canvas
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Crear patrón de fondo
            createBackgroundPattern();
            
            // Configurar controles táctiles
            setupTouchControls();
            
            // Event listeners para teclado
            document.addEventListener('keydown', function(e) {
                keys[e.key] = true;
            });
            
            document.addEventListener('keyup', function(e) {
                keys[e.key] = false;
            });
            
            // Botones de inicio y reinicio
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('restart-btn').addEventListener('click', startGame);
            
            // Dibujar pantalla de inicio
            drawStartScreen();
        }

        function resizeCanvas() {
            const gameScreen = document.getElementById('game-screen');
            canvas.width = gameScreen.offsetWidth;
            canvas.height = gameScreen.offsetHeight;
            
            if (backgroundPattern) {
                drawBackground();
            }
        }

        function createBackgroundPattern() {
            // Crear un patrón de fondo con motivos retro
            const patternCanvas = document.createElement('canvas');
            const patternCtx = patternCanvas.getContext('2d');
            patternCanvas.width = 20;
            patternCanvas.height = 20;
            
            patternCtx.fillStyle = '#0f380f';
            patternCtx.fillRect(0, 0, 20, 20);
            
            patternCtx.fillStyle = '#1a4d1a';
            patternCtx.fillRect(0, 0, 10, 10);
            patternCtx.fillRect(10, 10, 10, 10);
            
            backgroundPattern = ctx.createPattern(patternCanvas, 'repeat');
        }

        function drawBackground() {
            ctx.fillStyle = backgroundPattern;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Dibujar estrellas de fondo
            ctx.fillStyle = '#9bbc0f';
            for (let i = 0; i < 20; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height / 2;
                ctx.fillRect(x, y, 2, 2);
            }
        }

        function setupTouchControls() {
            // Controles táctiles para la cruceta
            const dPadButtons = document.querySelectorAll('.d-pad-btn');
            dPadButtons.forEach(button => {
                button.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    const direction = this.id;
                    keys['Arrow' + direction.charAt(0).toUpperCase() + direction.slice(1)] = true;
                });
                
                button.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    const direction = this.id;
                    keys['Arrow' + direction.charAt(0).toUpperCase() + direction.slice(1)] = false;
                });
            });
            
            // Botón de disparo táctil
            const shootBtn = document.getElementById('shoot-btn');
            shootBtn.addEventListener('touchstart', function(e) {
                e.preventDefault();
                keys['x'] = true;
            });
            
            shootBtn.addEventListener('touchend', function(e) {
                e.preventDefault();
                keys['x'] = false;
            });
        }

        function startGame() {
            // Ocultar pantallas de inicio/game over
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-over').style.display = 'none';
            
            // Reiniciar variables del juego
            player = new Player();
            enemies = [];
            bullets = [];
            score = 0;
            gameRunning = true;
            enemySpawnTimer = 0;
            
            document.getElementById('score').textContent = `Puntos: ${score}`;
            document.getElementById('health').textContent = `Vida: ${player.health}`;
            
            // Crear plataformas
            platforms = [
                new Platform(100, canvas.height - 100, 200, 20),
                new Platform(500, canvas.height - 150, 200, 20),
                new Platform(300, canvas.height - 200, 150, 20),
                new Platform(100, canvas.height - 250, 150, 20)
            ];
            
            // Iniciar bucle del juego
            requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            gameRunning = false;
            document.getElementById('final-score').textContent = `Puntos: ${score}`;
            document.getElementById('game-over').style.display = 'flex';
        }

        function gameLoop(timestamp) {
            if (!gameRunning) return;
            
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;
            
            // Limpiar canvas
            drawBackground();
            
            // Actualizar y dibujar plataformas
            platforms.forEach(platform => platform.draw());
            
            // Actualizar y dibujar jugador
            player.update(deltaTime);
            player.draw();
            
            // Generar enemigos
            enemySpawnTimer += deltaTime;
            if (enemySpawnTimer > 2000) { // Cada 2 segundos
                const side = Math.random() > 0.5 ? 1 : -1;
                const x = side > 0 ? -50 : canvas.width + 50;
                const y = Math.random() * (canvas.height - 100);
                enemies.push(new Enemy(x, y));
                enemySpawnTimer = 0;
            }
            
            // Actualizar y dibujar enemigos
            for (let i = enemies.length - 1; i >= 0; i--) {
                enemies[i].update();
                enemies[i].draw();
                
                // Eliminar enemigos fuera de pantalla
                if (enemies[i].x < -100 || enemies[i].x > canvas.width + 100) {
                    enemies.splice(i, 1);
                }
            }
            
            // Actualizar y dibujar balas
            for (let i = bullets.length - 1; i >= 0; i--) {
                const removeBullet = bullets[i].update();
                
                // Comprobar colisiones con enemigos
                for (let j = enemies.length - 1; j >= 0; j--) {
                    if (bullets[i].collideWith(enemies[j])) {
                        if (enemies[j].takeDamage()) {
                            enemies.splice(j, 1);
                            score += 10;
                            document.getElementById('score').textContent = `Puntos: ${score}`;
                        }
                        removeBullet = true;
                        break;
                    }
                }
                
                if (removeBullet) {
                    bullets.splice(i, 1);
                } else {
                    bullets[i].draw();
                }
            }
            
            // Continuar bucle del juego
            requestAnimationFrame(gameLoop);
        }

        function drawStartScreen() {
            drawBackground();
            ctx.fillStyle = '#9bbc0f';
            ctx.font = '20px "Courier New", monospace';
            ctx.textAlign = 'center';
            ctx.fillText('PLATAFORMA SHOOTER', canvas.width / 2, canvas.height / 2 - 30);
            ctx.font = '14px "Courier New", monospace';
            ctx.fillText('Toca JUGAR para comenzar', canvas.width / 2, canvas.height / 2 + 20);
        }

        // Iniciar cuando el documento esté cargado
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>