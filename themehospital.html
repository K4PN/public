<!DOCTYPE html><html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recordatorios ‚Äî Local (HTML √∫nico)</title>
  <meta name="description" content="P√°gina de recordatorios en un solo archivo HTML. Almacena datos en localStorage. Panel izquierdo: fecha y acciones. Panel derecho: filtros y lista enriquecida."/>
  <style>
    :root{
      --bg:#0b0c10;
      --panel:#11131a;
      --muted:#cbd5e1;
      --text:#e5e7eb;
      --accent:#60a5fa;
      --accent-2:#34d399;
      --danger:#ef4444;
      --warning:#f59e0b;
      --ok:#22c55e;
      --card:#0f172a;
      --chip:#1f2937;
      --shadow:0 10px 25px rgba(0,0,0,.35);
      --border:1px solid rgba(255,255,255,.08);
    }
    [data-theme="light"]{
      --bg:#f6f7fb;
      --panel:#ffffff;
      --muted:#475569;
      --text:#0f172a;
      --accent:#2563eb;
      --accent-2:#059669;
      --danger:#dc2626;
      --warning:#d97706;
      --ok:#16a34a;
      --card:#ffffff;
      --chip:#e5e7eb;
      --shadow:0 8px 20px rgba(2,6,23,.08);
      --border:1px solid rgba(2,6,23,.08);
    }*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  background:var(--bg); color:var(--text);
  display:grid; grid-template-columns:1fr 2fr; gap:16px; padding:16px; 
}
@media (max-width: 980px){
  body{grid-template-columns:1fr;}
  .left{position:static}
}

.panel{background:var(--panel); border-radius:18px; box-shadow:var(--shadow); border:var(--border)}

.left{position:sticky; top:16px; align-self:start; height:calc(100dvh - 32px); display:flex; flex-direction:column; overflow:hidden}
.left .date{padding:24px; border-bottom:var(--border)}
.date h1{margin:0; font-weight:800; letter-spacing:.4px; font-size:clamp(24px,3.5vw,42px)}
.date .today{opacity:.8; margin-top:6px}

.actions{padding:16px; display:grid; gap:12px; grid-auto-rows:minmax(44px,auto); overflow:auto}
.btn{display:flex; align-items:center; gap:10px; padding:12px 14px; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.04)); border:var(--border); border-radius:12px; cursor:pointer; user-select:none; transition:transform .06s ease, box-shadow .2s ease, background .2s ease}
.btn:hover{transform:translateY(-1px)}
.btn:active{transform:translateY(0)}
.btn .i{font-size:18px; opacity:.9}
.btn.primary{background:linear-gradient(180deg, rgba(96,165,250,.18), rgba(96,165,250,.06)); border-color:rgba(96,165,250,.35)}
.btn.danger{background:linear-gradient(180deg, rgba(239,68,68,.18), rgba(239,68,68,.06)); border-color:rgba(239,68,68,.35)}

.right{display:flex; flex-direction:column; min-height:0}
.filters{padding:12px 16px; display:grid; grid-template-columns:1.4fr .9fr .9fr .9fr .9fr .9fr auto; gap:10px; border-bottom:var(--border)}
@media (max-width: 1200px){
  .filters{grid-template-columns:1fr 1fr 1fr 1fr;}
  .filters .compact{grid-column:1 / -1}
}
@media (max-width: 720px){
  .filters{grid-template-columns:1fr 1fr;}
}

.input, select{width:100%; padding:10px 12px; border-radius:10px; border:var(--border); background:var(--card); color:var(--text); outline:none}
label.small{font-size:12px; opacity:.8; margin-bottom:6px; display:block}

.list{padding:16px; display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:14px; overflow:auto}

.card{background:var(--card); border:var(--border); border-left:6px solid var(--accent); border-radius:14px; padding:14px; display:flex; flex-direction:column; gap:10px; position:relative}
.card.done{opacity:.7; filter:saturate(.6)}
.title{font-weight:700; font-size:18px}
.desc{opacity:.9; white-space:pre-wrap}
.meta{display:flex; flex-wrap:wrap; gap:8px}
.chip{background:var(--chip); color:var(--text); border-radius:999px; padding:6px 10px; font-size:12px; border:var(--border)}
.chip.badge{font-weight:700}
.row{display:flex; align-items:center; justify-content:space-between; gap:12px}
.row .leftx{display:flex; align-items:center; gap:8px}

.actions-inline{display:flex; gap:8px}
.icon-btn{padding:8px 10px; border-radius:10px; border:var(--border); background:transparent; cursor:pointer}
.icon-btn:hover{background:rgba(255,255,255,.06)}

.priority-1{--accent:var(--danger)}
.priority-2{--accent:var(--warning)}
.priority-3{--accent:var(--ok)}

.status-toggle{display:flex; align-items:center; gap:8px}
.status-toggle input{accent-color:var(--accent)}

/* Modal */
dialog{border:none; border-radius:16px; width:min(680px, 94vw); background:var(--panel); color:var(--text); box-shadow:var(--shadow); padding:0}
dialog::backdrop{background:rgba(2,6,23,.55)}
.modal-header{padding:16px 18px; border-bottom:var(--border); display:flex; align-items:center; justify-content:space-between}
.modal-body{padding:16px 18px; display:grid; gap:12px}
.modal-grid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
@media (max-width:720px){.modal-grid{grid-template-columns:1fr}}
.modal-footer{padding:14px 18px; border-top:var(--border); display:flex; gap:10px; justify-content:flex-end}

.save{background:var(--accent); color:white; border:none}
.outline{background:transparent; border:var(--border); color:var(--text)}

/* Toast (flash) */
.toast{position:fixed; right:20px; bottom:20px; display:grid; gap:8px; z-index:50}
.toast .t{background:var(--panel); border-left:4px solid var(--accent); padding:12px 14px; border-radius:12px; box-shadow:var(--shadow); border:var(--border); animation:slideIn .18s ease}
.toast .t.err{border-left-color:var(--danger)}
@keyframes slideIn{from{transform:translateY(12px); opacity:0} to{transform:translateY(0); opacity:1}}

/* Header badges */
.tiny{font-size:12px; opacity:.8}
.muted{color:var(--muted)}

.sticky-top{position:sticky; top:16px; z-index:2}

  </style>
</head>
<body data-theme="dark">
  <!-- LEFT PANEL -->
  <aside class="panel left">
    <div class="date sticky-top">
      <h1 id="dateText">‚Äî</h1>
      <div class="today muted tiny" id="weekdayText">‚Äî</div>
    </div><div class="actions" id="leftActions">
  <div class="btn primary" id="btnNew"><span class="i">‚ûï</span><span>Nuevo recordatorio</span></div>
  <div class="btn" id="btnQuick"><span class="i">‚ö°</span><span>R√°pido para hoy</span></div>
  <div class="btn" id="btnExport"><span class="i">üì§</span><span>Exportar (.json)</span></div>
  <label class="btn" for="importFile" title="Importar JSON">
    <span class="i">üì•</span><span>Importar (.json)</span>
    <input id="importFile" type="file" accept="application/json" hidden>
  </label>
  <div class="btn danger" id="btnWipe"><span class="i">üóëÔ∏è</span><span>Vaciar todo (local)</span></div>
  <div class="btn" id="btnTheme"><span class="i">üåì</span><span>Tema claro/oscuro</span></div>
</div>

  </aside>  <!-- RIGHT PANEL -->  <main class="panel right">
    <!-- FILTERS -->
    <section class="filters sticky-top" aria-label="Filtros">
      <div>
        <label class="small" for="q">Buscar</label>
        <input class="input" id="q" placeholder="üîé t√≠tulo, descripci√≥n, etiquetas...">
      </div>
      <div>
        <label class="small" for="fStatus">Estado</label>
        <select id="fStatus">
          <option value="">Todos</option>
          <option value="open">Pendientes</option>
          <option value="done">Completados</option>
        </select>
      </div>
      <div>
        <label class="small" for="fPriority">Prioridad</label>
        <select id="fPriority">
          <option value="">Todas</option>
          <option value="1">Alta</option>
          <option value="2">Media</option>
          <option value="3">Baja</option>
        </select>
      </div>
      <div>
        <label class="small" for="fCategory">Categor√≠a</label>
        <select id="fCategory">
          <option value="">Todas</option>
        </select>
      </div>
      <div>
        <label class="small" for="fFrom">Desde</label>
        <input class="input" id="fFrom" type="date">
      </div>
      <div>
        <label class="small" for="fTo">Hasta</label>
        <input class="input" id="fTo" type="date">
      </div>
      <div class="compact">
        <label class="small" for="fSort">Orden</label>
        <select id="fSort">
          <option value="due_asc">Vencimiento ‚≠°</option>
          <option value="due_desc">Vencimiento ‚≠£</option>
          <option value="prio">Prioridad</option>
          <option value="created_desc">Reciente</option>
          <option value="created_asc">Antiguo</option>
          <option value="title">T√≠tulo A‚ÜíZ</option>
        </select>
      </div>
    </section><!-- LIST -->
<section class="list" id="list"></section>

  </main>  <!-- MODAL: CREATE/EDIT -->  <dialog id="editor">
    <form method="dialog" id="form">
      <div class="modal-header">
        <strong id="modalTitle">Nuevo recordatorio</strong>
        <button class="icon-btn outline" type="button" id="closeModal" title="Cerrar">‚úñ</button>
      </div>
      <div class="modal-body">
        <div>
          <label class="small" for="title">T√≠tulo *</label>
          <input class="input" id="title" required placeholder="Por ejemplo: Llamar a Juan"/>
        </div>
        <div>
          <label class="small" for="category">Categor√≠a</label>
          <input class="input" id="category" placeholder="Trabajo, Familia, Salud..."/>
        </div>
        <div class="modal-grid">
          <div>
            <label class="small" for="due">Vencimiento</label>
            <input class="input" id="due" type="datetime-local"/>
          </div>
          <div>
            <label class="small" for="priority">Prioridad</label>
            <select id="priority">
              <option value="2">Media</option>
              <option value="1">Alta</option>
              <option value="3">Baja</option>
            </select>
          </div>
        </div>
        <div>
          <label class="small" for="tags">Etiquetas (coma ,)</label>
          <input class="input" id="tags" placeholder="llamada, urgente, informe"/>
        </div>
        <div>
          <label class="small" for="notes">Descripci√≥n</label>
          <textarea class="input" id="notes" rows="5" placeholder="Detalles, enlaces, tel√©fonos..."></textarea>
        </div>
        <input type="hidden" id="rid">
      </div>
      <div class="modal-footer">
        <button class="icon-btn outline" value="cancel" type="button" id="cancelEdit">Cancelar</button>
        <button class="icon-btn save" id="saveBtn" value="default" type="submit">Guardar</button>
      </div>
    </form>
  </dialog>  <!-- TOASTS -->  <div class="toast" id="toast"></div>  <script>
  ;(()=>{
    const D = document;
    const $ = sel => D.querySelector(sel);
    const $$ = sel => Array.from(D.querySelectorAll(sel));

    const STORAGE_KEY = 'reminders_v1';
    /** @type {Array<{id:string,title:string,notes:string,priority:1|2|3,due:number|null,created:number,done:boolean,category:string,tags:string[]}>} */
    let items = [];

    const state = {
      q:'', status:'', prio:'', cat:'', from:'', to:'', sort:'due_asc'
    };

    const fmtDate = (ms)=>{
      if(!ms) return '‚Äî';
      const d = new Date(ms);
      const pad = n=> String(n).padStart(2,'0');
      return `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`
    };

    const todayHeader = ()=>{
      const d = new Date();
      const dias = ['domingo','lunes','martes','mi√©rcoles','jueves','viernes','s√°bado'];
      const meses = ['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre'];
      $('#dateText').textContent = `${d.getDate()} ${meses[d.getMonth()]} ${d.getFullYear()}`;
      $('#weekdayText').textContent = `${dias[d.getDay()]}`;
    };

    const uid = ()=>'r_'+Math.random().toString(36).slice(2,10)+Date.now().toString(36);

    const save = ()=>{ localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); };
    const load = ()=>{
      try{ items = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); }
      catch{ items = []; }
    };

    const toast = (msg, {error=false}={})=>{
      const t = D.createElement('div');
      t.className = 't'+(error?' err':'');
      t.textContent = msg;
      $('#toast').appendChild(t);
      setTimeout(()=>{ t.style.opacity = '0'; t.style.transform='translateY(6px)'; }, 2600);
      setTimeout(()=> t.remove(), 3000);
    };

    const humanPrio = p => p==1?'Alta':(p==2?'Media':'Baja');

    const buildFilters = ()=>{
      // categor√≠as din√°micas
      const cats = Array.from(new Set(items.map(i=>i.category).filter(Boolean))).sort((a,b)=>a.localeCompare(b));
      const sel = $('#fCategory');
      const current = sel.value;
      sel.innerHTML = '<option value="">Todas</option>' + cats.map(c=>`<option>${c}</option>`).join('');
      if(cats.includes(current)) sel.value = current;
    };

    const applyFilters = (list)=>{
      const q = state.q.trim().toLowerCase();
      const f = list.filter(it=>{
        if(state.status==='open' && it.done) return false;
        if(state.status==='done' && !it.done) return false;
        if(state.prio && String(it.priority)!==state.prio) return false;
        if(state.cat && it.category!==state.cat) return false;
        if(state.from){ const t = new Date(state.from).getTime(); if(!it.due || it.due < t) return false; }
        if(state.to){ const t = new Date(state.to).getTime(); if(!it.due || it.due > (t+24*60*60*1000-1)) return false; }
        if(q){
          const hay = (it.title+' '+(it.notes||'')+' '+(it.tags||[]).join(' ')).toLowerCase();
          if(!hay.includes(q)) return false;
        }
        return true;
      });
      const sort = state.sort;
      f.sort((a,b)=>{
        switch(sort){
          case 'due_asc': return (a.due||Infinity) - (b.due||Infinity);
          case 'due_desc': return (b.due||0) - (a.due||0);
          case 'prio': return a.priority - b.priority;
          case 'created_desc': return b.created - a.created;
          case 'created_asc': return a.created - b.created;
          case 'title': return a.title.localeCompare(b.title, 'es');
        }
        return 0;
      });
      return f;
    };

    const render = ()=>{
      buildFilters();
      const list = $('#list');
      list.innerHTML = '';
      const arr = applyFilters(items);
      if(arr.length===0){
        const empty = D.createElement('div');
        empty.className = 'card';
        empty.innerHTML = '<div class="title">No hay recordatorios</div><div class="muted">Crea uno con ‚ÄúNuevo recordatorio‚Äù.</div>';
        list.appendChild(empty); return;
      }
      arr.forEach(it=>{
        const c = D.createElement('article');
        c.className = `card priority-${it.priority} ${it.done?'done':''}`;
        c.dataset.id = it.id;
        c.innerHTML = `
          <div class="row">
            <div class="leftx">
              <div class="title">${escapeHTML(it.title)}</div>
            </div>
            <div class="actions-inline">
              <button class="icon-btn" data-act="edit" title="Editar">‚úèÔ∏è</button>
              <button class="icon-btn" data-act="dup" title="Duplicar">üóÇÔ∏è</button>
              <button class="icon-btn" data-act="del" title="Eliminar">üóëÔ∏è</button>
            </div>
          </div>
          <div class="meta">
            <span class="chip badge">${humanPrio(it.priority)}</span>
            ${ it.category ? `<span class="chip">#${escapeHTML(it.category)}</span>` : '' }
            ${ it.due ? `<span class="chip">‚è∞ ${fmtDate(it.due)}</span>` : '' }
            <span class="chip muted">Creado ${fmtDate(it.created)}</span>
          </div>
          ${ it.tags && it.tags.length ? `<div class="meta">${it.tags.map(t=>`<span class='chip'>${escapeHTML(t)}</span>`).join('')}</div>` : '' }
          ${ it.notes ? `<div class="desc">${linkify(escapeHTML(it.notes))}</div>` : '' }
          <div class="row">
            <label class="status-toggle"><input type="checkbox" ${it.done?'checked':''} data-act="toggle"> <span>${it.done?'Completado':'Pendiente'}</span></label>
          </div>
        `;
        list.appendChild(c);
      });
    };

    function escapeHTML(str){
      return (str||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));
    }
    function linkify(text){
      const urlRegex = /(https?:\/\/[\w.-]+(?:\/[\w\-.~:?#@!$&'()*+,;=%]*)?)/gi;
      return text.replace(urlRegex, '<a href="$1" target="_blank" rel="noopener">$1</a>');
    }

    // Modal helpers
    const openModal = (data)=>{
      $('#modalTitle').textContent = data? 'Editar recordatorio' : 'Nuevo recordatorio';
      $('#rid').value = data?.id || '';
      $('#title').value = data?.title || '';
      $('#notes').value = data?.notes || '';
      $('#priority').value = String(data?.priority || 2);
      $('#category').value = data?.category || '';
      $('#tags').value = (data?.tags||[]).join(', ');
      $('#due').value = data?.due ? toLocalInput(data.due) : '';
      $('#editor').showModal();
      setTimeout(()=>$('#title').focus(), 30);
    };
    const closeModal = ()=> $('#editor').close();

    const toLocalInput = (ms)=>{
      const d = new Date(ms); d.setMinutes(d.getMinutes()-d.getTimezoneOffset());
      return d.toISOString().slice(0,16);
    };

    const fromLocalInput = (val)=>{
      if(!val) return null;
      const d = new Date(val);
      // val is already local time; store as epoch ms
      return d.getTime();
    };

    // Event bindings
    $('#btnNew').addEventListener('click', ()=> openModal());
    $('#btnQuick').addEventListener('click', ()=>{
      const now = Date.now();
      const due = new Date(); due.setHours(23,59,0,0);
      const it = {id:uid(), title:'Recordatorio r√°pido', notes:'', priority:2, due: due.getTime(), created:now, done:false, category:'', tags:[]};
      items.unshift(it); save(); render(); toast('A√±adido para hoy ‚úÖ');
    });
    $('#btnExport').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(items,null,2)], {type:'application/json'});
      const a = D.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `recordatorios_${new Date().toISOString().slice(0,10)}.json`; a.click();
    });
    $('#importFile').addEventListener('change', (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          const data = JSON.parse(reader.result);
          if(Array.isArray(data)){
            // Merge by id; if id clashes, generate new id
            const map = new Map(items.map(i=>[i.id,i]));
            data.forEach(o=>{
              if(!o || typeof o!=='object') return;
              if(map.has(o.id)) o.id = uid();
              items.push({
                id:o.id||uid(),
                title:String(o.title||'Importado'),
                notes:String(o.notes||''),
                priority:Number(o.priority)||2,
                due:o.due||null,
                created:Number(o.created)||Date.now(),
                done:Boolean(o.done),
                category:String(o.category||''),
                tags:Array.isArray(o.tags)?o.tags.map(String):[]
              });
            });
            save(); render(); toast('Importaci√≥n completada');
          } else throw new Error('Formato no v√°lido');
        }catch(err){ toast('Error al importar', {error:true}); }
      };
      reader.readAsText(file);
      e.target.value = '';
    });

    $('#btnWipe').addEventListener('click', ()=>{
      if(confirm('¬øSeguro que quieres borrar TODOS los recordatorios locales?')){
        items = []; save(); render(); toast('Datos borrados');
      }
    });

    $('#btnTheme').addEventListener('click', ()=>{
      const cur = D.body.getAttribute('data-theme');
      D.body.setAttribute('data-theme', cur==='dark'?'light':'dark');
    });

    // Filters
    $('#q').addEventListener('input', e=>{ state.q = e.target.value; render(); });
    $('#fStatus').addEventListener('change', e=>{ state.status = e.target.value; render(); });
    $('#fPriority').addEventListener('change', e=>{ state.prio = e.target.value; render(); });
    $('#fCategory').addEventListener('change', e=>{ state.cat = e.target.value; render(); });
    $('#fFrom').addEventListener('change', e=>{ state.from = e.target.value; render(); });
    $('#fTo').addEventListener('change', e=>{ state.to = e.target.value; render(); });
    $('#fSort').addEventListener('change', e=>{ state.sort = e.target.value; render(); });

    // List actions (event delegation)
    $('#list').addEventListener('click', (e)=>{
      const btn = e.target.closest('button, input[type="checkbox"]');
      const card = e.target.closest('.card');
      if(!card) return;
      const id = card.dataset.id;
      const it = items.find(x=>x.id===id);
      if(!it) return;

      const act = btn?.dataset?.act;
      if(btn && act=== 'del'){
        if(confirm('¬øEliminar este recordatorio?')){
          items = items.filter(x=>x.id!==id); save(); render(); toast('Eliminado');
        }
      } else if(btn && act=== 'edit'){
        openModal(it);
      } else if(btn && act=== 'dup'){
        const cpy = {...it, id:uid(), title: it.title + ' (copia)', created: Date.now(), done:false};
        items.unshift(cpy); save(); render(); toast('Duplicado');
      } else if(btn && btn.type==='checkbox' && btn.dataset.act==='toggle'){
        it.done = !it.done; save(); render(); toast(it.done? 'Marcado como completado' : 'Marcado como pendiente');
      }
    });

    // Modal buttons
    $('#closeModal').addEventListener('click', closeModal);
    $('#cancelEdit').addEventListener('click', closeModal);

    $('#form').addEventListener('submit', (e)=>{
      e.preventDefault();
      const id = $('#rid').value.trim();
      const payload = {
        title: $('#title').value.trim(),
        notes: $('#notes').value.trim(),
        priority: Number($('#priority').value||2),
        category: $('#category').value.trim(),
        tags: $('#tags').value.split(',').map(s=>s.trim()).filter(Boolean),
        due: fromLocalInput($('#due').value)
      };
      if(!payload.title){ toast('El t√≠tulo es obligatorio',{error:true}); return; }

      if(id){
        const it = items.find(x=>x.id===id);
        if(it){ Object.assign(it, payload); save(); toast('Actualizado'); }
      } else {
        items.unshift({ id:uid(), created:Date.now(), done:false, ...payload });
        save(); toast('Guardado');
      }
      closeModal(); render();
    });

    // Initial
    todayHeader();
    load();
    render();
  })();
  </script></body>
</html>